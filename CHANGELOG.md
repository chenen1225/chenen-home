# 更新日志 (Changelog)

所有值得注意的项目更改都将记录在此文件中。

## [2.1.0] - 2025-01-25

### 新增功能 (Added)

#### AI 知识库系统
- 新增 `knowledge.html` - AI 知识库主页面
- 新增 `knowledge.js` - 知识库交互逻辑（757行代码）
- 新增 `knowledge-style.css` - 知识库专用样式（900行代码）

#### 核心功能
- **笔记管理系统**
  - 创建笔记：支持标题、内容、公开/私密权限设置
  - 编辑笔记：在线编辑，实时保存
  - 删除笔记：确认删除机制，防止误操作
  - 查看笔记：Markdown 渲染显示

- **文件夹管理系统**
  - 创建文件夹：自定义文件夹名称
  - 文件夹展开/折叠：记忆展开状态
  - 文件夹选中状态：点击选中，再次点击取消
  - 笔记计数：实时显示文件夹内笔记数量

- **拖拽功能**
  - 拖拽笔记到文件夹：直观的分类管理
  - 拖拽视觉反馈：拖拽时笔记半透明，文件夹高亮
  - 拖拽权限控制：仅登录用户可拖拽
  - 拖拽状态管理：防止重复移动

- **用户认证系统**
  - 管理员登录：默认账号 admin / admin123
  - 登录状态持久化：使用 localStorage
  - 权限控制：未登录用户只读，登录后可编辑
  - 退出登录：清理状态，隐藏编辑功能

- **数据持久化**
  - localStorage 存储：笔记、文件夹、展开状态、登录状态
  - 自动保存：每次操作后自动保存
  - 数据恢复：刷新页面后恢复所有数据

- **Markdown 渲染**
  - 支持标题（h1-h3）
  - 支持粗体、斜体
  - 支持行内代码和代码块
  - 支持链接
  - 支持列表
  - 支持水平线

#### UI/UX 设计
- **飞书/思源笔记风格**
  - 左侧文档树：层级清晰，操作直观
  - 右侧内容区：查看/编辑模式切换
  - 顶部导航栏：返回主页、登录/登出
  - 模态框设计：登录、创建文件夹

- **交互优化**
  - 点击文件夹：选中/取消选中
  - 双击文件夹：展开/折叠
  - 点击展开图标：展开/折叠
  - Toast 提示：操作反馈

- **响应式设计**
  - 桌面端：完整功能
  - 平板端：适配触摸
  - 移动端：优化布局
  - 小屏手机：紧凑显示

### 修复 (Fixed)

#### Bug 修复
- 修复 Toast 提示在移动端占用满屏的问题
  - 原因：Toast 使用了 `right: 1rem; left: 1rem;` 导致宽度占满
  - 解决：改为居中定位 `left: 50%; transform: translateX(-50%);`
  - 效果：Toast 现在在所有设备上居中显示，宽度适中

- 修复笔记保存到选中文件夹的逻辑问题
  - 原因：创建笔记时未使用 `currentFolder` 状态
  - 解决：在 `createNewNote()` 中添加 `folder: this.state.currentFolder`
  - 效果：选中文件夹后创建的笔记自动归类到该文件夹

- 修复文件夹选中状态不清晰的问题
  - 原因：缺少选中状态的视觉反馈
  - 解决：添加 `.doc-tree-folder.selected` 样式
  - 效果：选中的文件夹有明显的蓝色背景

### 改进 (Improved)

#### 用户体验改进
- 文件夹创建后自动展开
- 创建文件夹模态框打开时自动聚焦输入框
- 新建笔记时显示目标文件夹提示
- 拖拽笔记到文件夹时显示成功提示
- 退出登录时自动取消编辑状态

#### 代码质量改进
- 模块化设计：功能分离清晰
- 注释完善：每个功能模块都有详细注释
- 事件处理：使用 `stopPropagation()` 防止事件冒泡
- 状态管理：集中式状态管理，数据流清晰

### 技术实现细节 (Technical Details)

#### 文件结构
```
knowledge.js (757 lines)
├── 全局状态管理 (10-21)
├── 数据管理 (41-199)
├── 事件绑定 (205-233)
├── 登录/登出功能 (238-300)
├── 文档树渲染 (306-462)
├── 笔记查看 (468-495)
├── 笔记编辑 (501-635)
├── 文件夹管理 (641-726)
└── Markdown 渲染 (732-757)
```

#### 关键技术点
1. **HTML5 Drag and Drop API**
   - dragstart: 开始拖拽
   - dragend: 结束拖拽
   - dragover: 拖拽悬停
   - dragleave: 离开拖拽区
   - drop: 放置

2. **localStorage API**
   - 存储：`localStorage.setItem()`
   - 读取：`localStorage.getItem()`
   - 解析：`JSON.parse()` / `JSON.stringify()`

3. **DOM 操作**
   - 动态创建元素：`createElement()`
   - 事件监听：`addEventListener()`
   - 类名操作：`classList.add/remove/toggle()`

4. **CSS 技术**
   - CSS 变量：`:root` 定义主题色
   - Flexbox：布局
   - Grid：响应式网格
   - backdrop-filter：毛玻璃效果
   - CSS 动画：过渡效果

### 已知问题 (Known Issues)
- Markdown 渲染功能较简单，不支持表格、任务列表等高级语法
- 移动端拖拽体验有待优化（建议使用触摸长按触发）
- 没有搜索功能，笔记多时查找不便
- 没有标签系统，分类方式单一
- 没有导出功能，数据迁移困难

---

## [2.0.0] - 2024-XX-XX

### 改进
- 极简化设计，移除冗余模块
- 性能大幅优化，减少DOM操作
- 增强移动端体验
- 优化视觉效果和动画

---

## [1.0.0] - 2024-XX-XX

### 新增
- 初始版本发布
- 完整的个人主页模板
- 基础的社交媒体链接
- 响应式设计

---

## 变更日志格式

本项目遵循 [Semantic Versioning](https://semver.org/lang/zh-CN/) 版本规范。

变更类型：
- `Added` - 新增功能
- `Changed` - 功能变更
- `Deprecated` - 即将废弃的功能
- `Removed` - 已移除的功能
- `Fixed` - Bug 修复
- `Security` - 安全性改进
